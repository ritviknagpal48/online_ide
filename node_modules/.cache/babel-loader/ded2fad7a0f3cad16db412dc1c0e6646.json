{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _codemirror = _interopRequireDefault(require(\"codemirror\"));\n\nrequire(\"codemirror/mode/meta\");\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar ReactCodeMirror =\n/*#__PURE__*/\nfunction (_Component) {\n  (0, _inherits2.default)(ReactCodeMirror, _Component);\n\n  function ReactCodeMirror(props) {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, ReactCodeMirror);\n    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(ReactCodeMirror).call(this, props));\n    _this.codemirror = null;\n    _this.editor = null;\n    return _this;\n  }\n\n  (0, _createClass2.default)(ReactCodeMirror, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.renderCodeMirror();\n    }\n  }, {\n    key: \"renderCodeMirror\",\n    value: function renderCodeMirror() {\n      var _this2 = this; // 生成codemirror实例\n\n\n      this.editor = _codemirror.default.fromTextArea(this.textarea, this.props.options); // 获取CodeMirror用于获取其中的一些常量\n\n      this.codemirror = _codemirror.default; // 事件处理映射\n\n      var eventDict = this.getEventHandleFromProps();\n      Object.keys(eventDict).forEach(function (event) {\n        _this2.editor.on(eventDict[event], _this2.props[event]);\n      });\n      var _this$props = this.props,\n          value = _this$props.value,\n          width = _this$props.width,\n          height = _this$props.height; // 初始化值\n\n      this.editor.setValue(value || '');\n\n      if (width || height) {\n        // 设置尺寸\n        this.editor.setSize(width, height);\n      }\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function () {\n      var _componentWillReceiveProps = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee(nextProps) {\n        var val, next, options, width, height;\n        return _regenerator.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                val = this.editor.getValue();\n                next = nextProps.value;\n\n                if (next !== undefined && next !== this.props.value && next !== val) {\n                  this.editor.setValue(nextProps.value);\n                }\n\n                options = nextProps.options, width = nextProps.width, height = nextProps.height;\n                _context.next = 6;\n                return this.setOptions(options);\n\n              case 6:\n                if (width !== this.props.width || height !== this.props.height) {\n                  this.editor.setSize(width, height);\n                }\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function componentWillReceiveProps(_x) {\n        return _componentWillReceiveProps.apply(this, arguments);\n      };\n    }() // http://codemirror.net/doc/manual.html#config\n\n  }, {\n    key: \"setOptions\",\n    value: function () {\n      var _setOptions = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee2(options) {\n        var _this3 = this;\n\n        var mode;\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!((0, _typeof2.default)(options) === 'object')) {\n                  _context2.next = 7;\n                  break;\n                }\n\n                mode = _codemirror.default.findModeByName(options.mode);\n\n                if (!(mode && mode.mode)) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                _context2.next = 5;\n                return import(\"codemirror/mode/\".concat(mode.mode, \"/\").concat(mode.mode, \".js\"));\n\n              case 5:\n                if (mode) {\n                  options.mode = mode.mime;\n                }\n\n                Object.keys(options).forEach(function (name) {\n                  if (options[name] && JSON.stringify(options[name])) {\n                    _this3.editor.setOption(name, options[name]);\n                  }\n                });\n\n              case 7:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      return function setOptions(_x2) {\n        return _setOptions.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (this.editor) {\n        this.editor.toTextArea();\n      }\n    } // 将props中所有的事件处理函数映射并保存\n\n  }, {\n    key: \"getEventHandleFromProps\",\n    value: function getEventHandleFromProps() {\n      var propNames = Object.keys(this.props);\n      var eventHandle = propNames.filter(function (prop) {\n        return /^on+/.test(prop);\n      });\n      var eventDict = {};\n      eventHandle.forEach(function (ele) {\n        eventDict[ele] = ele.replace(/^on[A-Z]/g, function (s) {\n          return s.slice(2).toLowerCase();\n        });\n      });\n      return eventDict;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return _react.default.createElement(\"textarea\", {\n        ref: function ref(instance) {\n          _this4.textarea = instance;\n        }\n      });\n    }\n  }]);\n  return ReactCodeMirror;\n}(_react.Component);\n\nexports.default = ReactCodeMirror;\nReactCodeMirror.defaultProps = {\n  value: '',\n  options: {},\n  width: '100%',\n  height: '100%'\n};\nReactCodeMirror.propTypes = {\n  value: _propTypes.default.string,\n  options: _propTypes.default.object,\n  width: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.number]),\n  height: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.number])\n};","map":null,"metadata":{},"sourceType":"script"}